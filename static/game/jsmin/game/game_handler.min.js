class GameHandler extends GraphicsObject{#state;#difficulty;#attackRunner;#box;#player;#hud;#undyne;#startButton;#playAgainButton;constructor(e,t){super(),this.#state="init",""!==t&&Main.runner.assetManager.getAudio("introBgm").play();let n=0;switch(e){case"easy":n=1;break;case"medium":n=5;break;case"hard":n=10}this.#difficulty=e;var a=""===t?[]:AttackParser.parse(t);this.#undyne=new Undyne(e),this.#box=new Box,this.#player=new Player(e),this.#undyne.player=this.#player,this.#undyne.speechBubble.undyne=this.#undyne,this.#hud=new Hud(a.length,n,this.#player),this.#attackRunner=new AttackRunner(this.#player,this.#hud,a),this.#startButton=new Button(.5*(Main.runner.gameWidth-113),.5*Main.runner.gameHeight+85,113,53,"startButton",this.restartLevel.bind(this),"startButtonHover",()=>Main.runner.assetManager.getAudio("buttonHoverSfx").play(),300);this.#playAgainButton=new Button(.5*(Main.runner.gameWidth-197),.5*Main.runner.gameHeight+85,197,53,"playAgainButton",this.restartLevel.bind(this),"playAgainButtonHover",()=>Main.runner.assetManager.getAudio("buttonHoverSfx").play(),300),this.#playAgainButton.visible=!1,this.#box.setDestinationBounds(.5*Main.runner.gameWidth-Player.shieldDistance,.5*Main.runner.gameWidth+Player.shieldDistance,.5*Main.runner.gameHeight-Player.shieldDistance,.5*Main.runner.gameHeight+Player.shieldDistance),""===t&&(this.#startButton.visible=!1,this.#hud.badLevelMode(),this.#handleEmptyLevelData())}#handleEmptyLevelData(){new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).id?this.#undyne.speechBubble.queueText(["...","Do YOU think this is\na VALID level?","Well it isn't.","Get out of here!"],()=>{location.href="/"}):this.#undyne.speechBubble.queueText(["What the HELL do you\nthink you are doing,\npunk?","You can't get here\nwithout choosing a\nlevel.","Get out of here!"],()=>{location.href="/"})}handleKeyInput(e){if("X"===e?this.#undyne.speechBubble.advanceTextX():"Z"===e&&this.#undyne.speechBubble.advanceTextZ(),"playing"===this.#state&&"green"===this.#player.heartColor)switch(e){case"left":this.#player.shieldDir=1;break;case"right":this.#player.shieldDir=3;break;case"up":this.#player.shieldDir=2;break;case"down":this.#player.shieldDir=0}}restartLevel(){Main.runner.assetManager.getAudio("introBgm").stop(),Main.runner.assetManager.getAudio("buttonSelectSfx").play(),this.#state="playing",this.#startButton.visible=!1,this.#playAgainButton.visible=!1,this.#attackRunner.reset(),this.#player.reset(),this.#hud.reset(),this.#undyne.reset(),this.#undyne.swingArm(),this.#box.setDestinationBounds(.5*Main.runner.gameWidth-Player.shieldDistance,.5*Main.runner.gameWidth+Player.shieldDistance,.5*Main.runner.gameHeight-Player.shieldDistance,.5*Main.runner.gameHeight+Player.shieldDistance),this.#undyne.opacity=.2,this.#attackRunner.addNextAttack()}endGame(e){this.#state=e,this.#attackRunner.removeAllArrows(),this.#player.hideShieldSprites(),this.#undyne.greenRectangleManager.visible=!1,this.#undyne.swingArm(),this.#undyne.opacity=1,Undyne.getBgm(this.#difficulty).stop();let t;"game over"===e?t=UndyneDialogue.getGameOverText(this.#hud.currentAttackNumber,this.#attackRunner.numAttacks,this.#difficulty):"win"===e&&(t=UndyneDialogue.getWinText(this.#difficulty)),this.#undyne.speechBubble.queueText(t,()=>{this.#playAgainButton.visible=!0})}update(e){this.#undyne.update(e),this.#player.update(e),this.#box.update(e),this.#startButton.update(e),this.#playAgainButton.update(e),"playing"===this.#state&&"swinging arm"!==this.#undyne.animationState&&(this.#attackRunner.update(e),this.#hud.update(e),0===this.#player.hp?(this.render(),this.endGame("game over")):this.#hud.currentAttackNumber===this.#attackRunner.numAttacks&&this.#attackRunner.arrowsEmpty()&&(this.render(),this.endGame("win"))),Main.runner.gameplayStage.position.set(this.#player.damageShift,this.#player.damageShift),this.render()}render(){this.#box.render(),this.#hud.render(),this.#undyne.render(),Main.runner.rendererManager.render(Main.runner.gameplayStage)}}
