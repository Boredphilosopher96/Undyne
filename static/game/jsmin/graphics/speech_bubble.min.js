class SpeechBubble extends GraphicsObject{static#charsPerSec=25;#curText;#textState;#textQueue;#textQueueCallback;#numTextChars;#undyne;#sprite;#speechText;constructor(){super(),this.#curText=null,this.#textState="none",this.#textQueue=[],this.#textQueueCallback=null,this.#numTextChars=0,this.#sprite=new PIXI.Sprite(Main.runner.assetManager.getTexture("speechBubble")),this.#sprite.anchor.set(0,.5),this.#sprite.position.set(400,60),this.#sprite.visible=!1,this.#speechText=new PIXI.extras.BitmapText("",{font:"12px SpeechBubble",align:"left"}),this.#speechText.maxWidth=180,this.#speechText.position.set(442,24),this.#speechText.tint=0,this.#speechText.visible=!1,Main.runner.gameplayStage.addChild(this.#sprite),Main.runner.gameplayStage.addChild(this.#speechText)}set undyne(t){this.#undyne=t}queueText(t,e){"swinging arm"===this.#undyne.animationState?setTimeout(()=>this.queueText(t,e),250):(this.#textQueue=this.#textQueue.concat(t),this.#textQueueCallback=e,this.#sprite.visible=!0,this.#speechText.visible=!0,this.selectNextText())}selectNextText(){0<this.#textQueue.length?(this.#curText=this.#textQueue.shift(),this.#numTextChars=0,this.#textState="talking"):(this.#curText=null,this.#sprite.visible=!1,this.#speechText.visible=!1,this.#textState="none",this.#textQueueCallback())}advanceTextChars(t){var e;this.#curText&&(t=Math.floor(t)," "!==(e=this.#curText[t])&&"\n"!==e&&Main.runner.assetManager.getAudio("undyneSpeakSfx").play(),this.#speechText.text=this.#curText.substring(0,t))}advanceTextZ(){"waiting"===this.#textState&&this.selectNextText()}advanceTextX(){"talking"===this.#textState&&(this.#speechText.text=this.#curText,this.#textState="waiting")}reset(){this.#curText=null,this.#textState="none",this.#textQueue=[],this.#textQueueCallback=null,this.#numTextChars=0,this.#speechText.text="",this.#sprite.visible=!1,this.#speechText.visible=!1}update(t){"talking"===this.#textState&&(t=this.#numTextChars+SpeechBubble.#charsPerSec*t/1e3,Math.floor(t)>this.#numTextChars&&this.advanceTextChars(t),this.#numTextChars>=this.#curText.length&&(this.#textState="waiting"),this.#numTextChars=t)}}
